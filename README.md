# grunt-contrib-tuning

> Tuning parameters

## Getting Started

This plugin requires Grunt `~0.4.1`

```shell
npm install grunt-hoge --save-dev
```

One the plugin has been installed, it may be enabled inside your Gruntfile with this line of JavaScript:

```js
grunt.loadNpmTasks('grunt-contrib-tuning');
```

## The "tuning" task

### Overview
In your project's Gruntfile, add a section named `tuning` to the data object passed into `grunt.initConfig()`.

```javascript
grunt.initConfig 
  tuning:
    servertest: 
      params: 
        maxConnection:
          range: [1, 100]
      limit: 100
      target: 0.3
      # requreid: trial command
      command: (env, params, next)->
        server = createServer(env.port, params.maxConnection)
        timeperrequest = bench(server, con= 10) 
        next(null, timeperrequest)
      done: (err, results)-> 
        console.log results
```

### Options

#### target

Type: `number`
Default value: `1`

Target cost value.
When cost of each trial is lesser than this value, `done` method is called

#### limit

Type: `number`
Default value: `10`

The trial max number.
Even if all trials cannot archive target value, the tuning is up when the trial number reaches this value.

#### params

Type: `object`
Default value: `{}`

The params passed to trials declared by `command` definition.
Each paramter in `params` takes `range` only (version 0.0.0).

#### command

Type: `function`

In each trial this method is called.
The method takes arguments below:

* `env`: if set `env`, this value is set the result of `env` method.
* `params`: parameter set you defined in `params`
* `next`: you must call this method when trial done.

#### begin

Type: `function`

If you want to use common data through all trials, you can use `begin` method.
```javascript
begin: function(next){
    var common = {username: 'muddydixon'};
    next(common);
}
```

You can get this common data via `env` arguments in `commmand` method.



#### env

Type: `function`
Default value: `function(){}`

In each trial `command` method takes `env` generated by `env` option.
For example, you tuning web servers paramter like `max connection`.
You define `env` options like:

```javascript
env: function(){
  var port = 10000;
  return function(){
    return {port: port++};
  }
}
```

In `command` method, you can get `{port: 10000}`, `{port: 10001}` and so on.

#### done
Type: `function`
Optional

When tuning is up, this method is called.


### Usage Examples

#### Default Options

```
grunt.initConfig 
  tuning:
    # required: tuning case name
    servertest: 
      # required: tuning parameter list
      params: 
        alpha:
          range: [1, 100]
        beta:
          range: [5, 10]
        gamma:
          range: [10, 100]
      # optional: if define this method, it passed to `command`
      env: ()->
        port = 10000
        ()->
          {port: port++}
      # optional (default 10): limit case number            
      limit: 10
      # optional (default 1):
      #   target cost value
      #   when cost of each trial is lesser than this value,
      #     `done` method is called
      target: 0.3
      # requreid: trial command
      command: (env, params, next)->
        setTimeout ()->
            next(null, Math.random())
          Math.random() * 1000
      # optional: when tuning ends, this method be called 
      done: (err, results)-> 
        console.log results
```


# TODO

* parameter change strategy
* define `command` as string such as `ab -c 100 -n 1000 http://127.0.0.1:8080/ 2>/dev/null | grep 'Requests per second' | ruby -ne 'puts $_[/\d+\.\d+/]`

# Author

Muddy Dixon muddydixon@gmail.com

# License

Copyright 2013- Muddy Dixon (muddydixon)

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.

